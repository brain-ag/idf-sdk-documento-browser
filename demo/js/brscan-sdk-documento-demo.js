function startDemo(e){e.preloadModelos(),console.log(e.versaoDocumento);const t=loadConfig();e.tamanhoArquivos=t.tamanhoArquivos,e.enviarTxt=t.enviarTxt,e.capturaEmDesktop=t.capturaEmDesktop,e.qntTentativasCapManual=t.qntTentativasCapManual,e.limiteNumeroTentativasErro=t.limiteNumeroTentativasErro,e.timeoutCaptura=t.timeoutCaptura,e.documentosAceitos=convertStringToArray(t.documentosAceitos),e.wizzard=t.wizzard,document.documentElement.style.setProperty("--cor-primary",t.corPrimary),document.documentElement.style.setProperty("--font-family",t.fontFamily),e.iniciaCaptura(document.getElementById("documento"),(e=>{console.log("callback: ",e)})).then((e=>{if(console.log("demo app return: ",e),document.body.style.overflow="auto",hideLoginContainer(),showResultContainer(),Array.isArray(e.image)){let t=e.image[0];t&&(document.getElementById("imgA").src=t);let n=e.image[1];n&&(document.getElementById("imgB").src=n)}document.getElementById("jsonResult").textContent=JSON.stringify(e)})).catch((e=>{hideLoginContainer(),showResultContainer(),document.getElementById("jsonResult").textContent=JSON.stringify(e),300!=e.id&&30!=e.id||(deleteCookie("bearerToken"),deleteCookie("legacyToken"))}))}function convertStringToArray(e){return e.includes(",")?e.split(","):[e]}function clearCookies(){document.cookie.split(";").forEach((function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}))}function deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}function hideLoginContainer(){document.getElementById("login").style.display="none"}function hideResultContainer(){document.getElementById("sdkResult").style.display="none",document.getElementById("imgA").src="",document.getElementById("imgB").src="",document.getElementById("jsonResult").textContent=""}function showLoginContainer(){document.getElementById("login").style.display="block"}function showResultContainer(){document.getElementById("sdkResult").style.display="block"}function getSerasaIamUrl(e){return`${BASE_URL}/security/iam/v1/user-identities/login?clientId=${e}`}function getClientTokenURL(){return`${BASE_URL}/security/iam/v1/client-identities/login`}function disableAllButtons(){document.querySelectorAll("button").forEach((e=>{e.disabled=!0}))}function enableAllButtons(){document.querySelectorAll("button").forEach((e=>{e.disabled=!1}))}function setCookie(e,t){const n=new Date;n.setTime(n.getTime()+36e5);const o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function getCookie(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e];for(;" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}async function getToken(e,t,n){return new Promise((async(o,a)=>{let i=new Headers;i.append("Authorization","Basic "+btoa(t+":"+n));let c=await fetch(e,{method:"POST",headers:i});try{o((await c.json()).accessToken)}catch(e){console.log("ex",e),a({id:"INVALID_AUTHENTICATION",desc:"Erro ao gerar token. Por favor, verifique as credenciais e tente novamente."})}}))}function initApp(){const e=getCookie("bearerToken"),t=getCookie("legacyToken");hideResultContainer(),e?(hideLoginContainer(),startDemo(new window.BrScanSDKDocumento.Documento(e,""))):t?startDemo(new window.BrScanSDKDocumento.Documento({chave:t})):(showLoginContainer(),console.log("Nenhum token encontrado, redirecionando para login."))}document.getElementById("legacyButton").addEventListener("click",(function(){var e=document.getElementById("legacyKey").value,t=document.getElementById("error-message");""===e?(t.style.display="block",t.textContent="Por favor, preencha o campo com a chave legada"):(t.style.display="none",t.textContent="",setCookie("legacyToken",e),startDemo(new window.BrScanSDKDocumento.Documento({chave:e})))})),document.getElementById("loginButton").addEventListener("click",(function(){var e=document.getElementById("clientId").value,t=document.getElementById("username").value,n=document.getElementById("password").value,o=document.getElementById("error-message");""===e||""===n?(o.style.display="block",o.textContent="Por favor, preencha os campos de clientId, user e senha."):""===t?(disableAllButtons(),o.style.display="none",o.textContent="",(async()=>{await getToken(getClientTokenURL(),e,n).then((e=>{enableAllButtons(),e?(setCookie("bearerToken",e),o.style.display="none",startDemo(new window.BrScanSDKDocumento.Documento(e,""))):(o.style.display="block",o.textContent="Erro na autenticação",console.log("Erro na autenticação"))})).catch((e=>{enableAllButtons(),o.style.display="block",o.textContent=e,console.log("err",e)}))})()):(disableAllButtons(),o.style.display="none",o.textContent="",(async()=>{await getToken(getSerasaIamUrl(e),t,n).then((e=>{enableAllButtons(),e?(setCookie("bearerToken",e),o.style.display="none",startDemo(new window.BrScanSDKDocumento.Documento(e,""))):(o.style.display="block",o.textContent="Erro na autenticação",console.log("Erro na autenticação"))})).catch((e=>{enableAllButtons(),o.style.display="block",o.textContent=e,console.log("err",e)}))})())})),document.getElementById("tryAgain").addEventListener("click",(function(){initApp()})),document.addEventListener("DOMContentLoaded",(function(e){const t=document.createElement("script");switch(t.type="text/javascript",console.log("loaded env: ",SERASA_SDK_ENV),SERASA_SDK_ENV){case"dev":t.src="../brscan-dev-sdk-documento.min.js";break;case"uat":t.src="../brscan-uat-sdk-documento.min.js";break;case"prod":t.src="../brscan-sdk-documento.min.js";break;default:alert(`Ambiente ${SERASA_SDK_ENV} não encontrado`)}t.onload=function(){initApp()},window.document.body.appendChild(t)}));